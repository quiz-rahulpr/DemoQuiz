<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz Portal</title>
    <script src="questions.js"></script>
    <style>
        :root { --primary: #2563eb; --success: #22c55e; --danger: #ef4444; --gray: #e2e8f0; --dark: #0f172a; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background: #f8fafc; color: var(--dark); -webkit-tap-highlight-color: transparent; }

        /* Header */
        .header { 
            display: flex; justify-content: space-between; align-items: center;
            background: white; padding: 12px 16px; border-bottom: 1px solid var(--gray);
            position: sticky; top: 0; z-index: 100; height: 60px; box-sizing: border-box;
        }
        .quiz-title { font-weight: 800; font-size: 1rem; color: var(--primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 60%; }
        .timer { font-family: 'Courier New', monospace; font-weight: bold; color: var(--danger); font-size: 1.2rem; }

        /* Navigation Drawer */
        #nav-drawer {
            position: fixed; top: 0; right: -285px; width: 280px; height: 100%;
            background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            z-index: 1001; transition: transform 0.3s cubic-bezier(0, 0, 0.2, 1);
            display: flex; flex-direction: column;
        }
        #nav-drawer.open { transform: translateX(-285px); }
        .drawer-header { padding: 20px; border-bottom: 1px solid var(--gray); }
        .drawer-content { flex: 1; overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; }

        .nav-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 20px; }
        .nav-dot { 
            aspect-ratio: 1/1; border: 1px solid #cbd5e1; border-radius: 6px;
            display: flex; align-items: center; justify-content: center; font-size: 0.85rem;
            background: white; cursor: pointer; font-weight: 500;
        }
        .nav-dot.attempted { background: var(--primary); color: white; border-color: var(--primary); }
        .nav-dot.current { border: 2px solid black; background: #f1f5f9; }

        /* Quiz UI */
        .container { padding: 16px; max-width: 600px; margin: auto; }
        .question-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid var(--gray); }
        .option-item { padding: 14px; margin: 10px 0; border: 2px solid var(--gray); border-radius: 10px; display: flex; align-items: center; cursor: pointer; transition: 0.1s; }
        .option-item input { width: 20px; height: 20px; margin-right: 12px; flex-shrink: 0; }
        
        /* Controls */
        .controls { display: flex; justify-content: space-between; gap: 10px; margin-top: 25px; }
        button { border: none; border-radius: 8px; font-weight: 700; font-size: 0.95rem; cursor: pointer; }
        .btn-prev { background: #cbd5e1; color: var(--dark); flex: 1; padding: 15px; }
        .btn-next { background: var(--primary); color: white; flex: 1; padding: 15px; }
        .btn-menu { background: #f1f5f9; color: var(--dark); width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }

        /* Screens */
        #login-screen, #quiz-screen, #final-screen, #review-screen { display: none; }
        .active { display: block !important; }
        
        #final-screen { text-align: center; padding-top: 10vh; }
        .score-display { font-size: 2.5rem; font-weight: 800; color: var(--primary); margin: 20px 0; }

        /* Review Section Styles */
        .review-card { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; border: 1px solid var(--gray); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .review-option { padding: 10px; border: 1px solid var(--gray); margin: 5px 0; border-radius: 6px; color: #64748b; font-size: 0.9rem; }
        
        /* New Color Classes for Review */
        .review-correct { border: 2px solid var(--success); background: #dcfce7; color: var(--success); font-weight: bold; }
        .review-wrong { border: 2px solid var(--danger); background: #fee2e2; color: var(--danger); font-weight: bold; }

        .q-text-review { font-weight: bold; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div id="nav-drawer">
        <div class="drawer-header">
            <h3 style="margin:0">Question Status</h3>
            <small>Tap a number to jump</small>
        </div>
        <div class="drawer-content"><div class="nav-grid" id="nav-grid"></div></div>
        <div style="padding: 15px; border-top: 1px solid var(--gray);">
            <button onclick="toggleMenu()" style="background: var(--dark); color: white; width: 100%; padding: 12px;">Back to Question</button>
        </div>
    </div>

    <div id="login-screen" class="active container">
        <div class="question-card" style="margin-top: 50px; text-align: center;">
            <h1 style="color:var(--primary); margin-bottom: 8px;">Examination Name</h1>
            <p style="color: #64748b;">Enter your full name to begin</p>
            <input type="text" id="userName" placeholder="Type your name here..." style="width:100%; padding:15px; margin:20px 0; border:2px solid var(--gray); border-radius:8px; font-size: 1rem; box-sizing:border-box;">
            <button onclick="startQuiz()" class="btn-next" style="width:100%">Start Quiz Now</button>
        </div>
    </div>

    <div id="quiz-screen">
        <div class="header">
            <span class="quiz-title">YOUR QUIZ TITLE HERE</span>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span class="timer" id="timer">30:00</span>
                <button class="btn-menu" onclick="toggleMenu()">☰</button>
            </div>
        </div>
        <div class="container">
            <div class="question-card">
                <span id="q-counter" style="color: var(--primary); font-weight: bold; font-size: 0.8rem;">QUESTION 1</span>
                <h3 id="q-text" style="margin-top: 10px; line-height: 1.4;"></h3>
                <div id="options-container"></div>
                <div class="controls">
                    <button id="prevBtn" class="btn-prev" onclick="changeQuestion(-1)">Previous</button>
                    <button id="nextBtn" class="btn-next" onclick="changeQuestion(1)">Next Question</button>
                    <button id="submitBtn" class="btn-next" style="background:var(--success); display:none;" onclick="finishQuiz()">Submit Final Result</button>
                </div>
            </div>
        </div>
    </div>

    <div id="final-screen" class="container">
        <div style="font-size: 4rem; margin-bottom: 10px;">✅</div>
        <div id="final-msg-container"></div>
    </div>

    <div id="review-screen" class="container">
        <h2 style="text-align: center; color: var(--primary); margin-top: 10px;">Your Responses</h2>
        <div style="text-align: center; margin-bottom: 15px; font-size: 0.8rem;">
            <span style="color:var(--success); font-weight:bold;">✔ Correct Answer</span> &nbsp;&nbsp; 
            <span style="color:var(--danger); font-weight:bold;">✖ Your Wrong Answer</span>
        </div>
        <div id="review-list"></div>
        <div style="margin-top: 20px;">
            <button class="btn-prev" style="width:100%" onclick="location.reload()">Close / Exit</button>
        </div>
    </div>

    <script>
        let currentIdx = 0;
        let userAnswers = new Array(quizQuestions.length).fill(null);
        let timeLeft = 30 * 60;
        let timerInterval;

        const FORM_ID = "1FAIpQLSfdc6KygQ100hICyXkaJYIWVJ7UxKYUw4aV22smmT3nRWCu3g"; 
        const ENTRY_NAME = "entry.1088098272";
        const ENTRY_SCORE = "entry.1899459571";
        const ENTRY_TIME = "entry.1956296565";

        function toggleMenu() {
            const drawer = document.getElementById('nav-drawer');
            const overlay = document.getElementById('overlay');
            if (drawer.classList.contains('open')) {
                drawer.classList.remove('open');
                overlay.style.display = 'none';
            } else {
                renderNav();
                drawer.classList.add('open');
                overlay.style.display = 'block';
            }
        }

        function startQuiz() {
            const name = document.getElementById('userName').value.trim();
            if(!name) return alert("Please enter your name");
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('quiz-screen').classList.add('active');
            loadQuestion();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                let mins = Math.floor(timeLeft / 60);
                let secs = timeLeft % 60;
                document.getElementById('timer').innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
                if(timeLeft <= 0) finishQuiz();
            }, 1000);
        }

        function renderNav() {
            const grid = document.getElementById('nav-grid');
            grid.innerHTML = '';
            quizQuestions.forEach((_, i) => {
                const dot = document.createElement('div');
                dot.className = `nav-dot ${userAnswers[i] !== null ? 'attempted' : ''} ${i === currentIdx ? 'current' : ''}`;
                dot.innerText = i + 1;
                dot.onclick = () => { currentIdx = i; loadQuestion(); toggleMenu(); };
                grid.appendChild(dot);
            });
        }

        function loadQuestion() {
            const q = quizQuestions[currentIdx];
            document.getElementById('q-counter').innerText = `QUESTION ${currentIdx + 1} OF ${quizQuestions.length}`;
            document.getElementById('q-text').innerText = q.question;
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.options.forEach((opt, i) => {
                const div = document.createElement('label');
                div.className = 'option-item';
                div.innerHTML = `<input type="radio" name="quizOpt" value="${i}" ${userAnswers[currentIdx] === i ? 'checked' : ''} onchange="saveAnswer(${i})"> <span>${opt}</span>`;
                container.appendChild(div);
            });
            document.getElementById('prevBtn').style.visibility = currentIdx === 0 ? 'hidden' : 'visible';
            document.getElementById('nextBtn').style.display = currentIdx === quizQuestions.length - 1 ? 'none' : 'block';
            document.getElementById('submitBtn').style.display = currentIdx === quizQuestions.length - 1 ? 'block' : 'none';
        }

        function saveAnswer(val) { userAnswers[currentIdx] = val; }

        function changeQuestion(step) {
            currentIdx += step;
            loadQuestion();
            window.scrollTo(0,0);
        }

        function finishQuiz() {
            if(timeLeft > 0 && !confirm("Finish and submit your answers?")) return;
            clearInterval(timerInterval);
            
            // Score Calculation
            let score = 0;
            userAnswers.forEach((ans, i) => {
                if(ans === null) return;
                if(ans === quizQuestions[i].correct) { score += 1; } 
                else { score -= (1/3); }
            });
            const finalScore = score.toFixed(2);
            
            const name = document.getElementById('userName').value;
            const timeTaken = Math.floor((30 * 60 - timeLeft) / 60) + " mins";

            // Send data
            const formUrl = `https://docs.google.com/forms/d/e/${FORM_ID}/formResponse?${ENTRY_NAME}=${encodeURIComponent(name)}&${ENTRY_SCORE}=${finalScore}&${ENTRY_TIME}=${timeTaken}&submit=Submit`;
            fetch(formUrl, { mode: 'no-cors' });
            
            document.getElementById('quiz-screen').classList.remove('active');
            document.getElementById('final-screen').classList.add('active');

            document.getElementById('final-msg-container').innerHTML = `
                <h2 style="margin: 0 0 20px 0; color: var(--dark);">Hi ${name}</h2>
                <p style="color: #475569; font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px;">
                    Your mark has been submitted.<br>
                    <strong>Ranklist will be soon available.</strong>
                </p>
                <button class="btn-next" onclick="showReview()">View Your Response</button>
            `;
        }

        function showReview() {
            document.getElementById('final-screen').classList.remove('active');
            document.getElementById('review-screen').classList.add('active');
            
            const list = document.getElementById('review-list');
            list.innerHTML = '';

            quizQuestions.forEach((q, i) => {
                let cardHtml = `<div class="review-card">
                    <span class="q-text-review">Q${i+1}: ${q.question}</span>`;
                
                q.options.forEach((opt, optIdx) => {
                    const isSelected = userAnswers[i] === optIdx;
                    const isCorrect = q.correct === optIdx;
                    
                    let styleClass = 'review-option';
                    let icon = '○ ';

                    if (isCorrect) {
                        styleClass += ' review-correct'; // Green
                        icon = '✔ ';
                    } else if (isSelected) {
                        styleClass += ' review-wrong'; // Red
                        icon = '✖ ';
                    }
                    
                    cardHtml += `<div class="${styleClass}">${icon} ${opt}</div>`;
                });

                cardHtml += `</div>`;
                list.innerHTML += cardHtml;
            });
            
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>
